---
layout: default
title: Implementació d'una API REST.
nav_order: 1
parent: 10. Serveis Web I Api Rest (JSON)
has_children: false 
---

# Implementació d'una API RESTful en PHP

Anem a implementar una API senzilla basada en el nostre
framework MVC.

Tindrem els següents _endpoints_ que caldrà definir en la taula
de rutes.

* POST /api/v1/movies
* GET /api/v1/movies
* GET /api/v1/movies/:id 

Tin en compte que aquesta versió és molt bàsica i té mancances quant a 
validació i filtratge de dades. 

Com hem vist en l'apartat anterior el servidor respon a les sol·licitud HTTP
amb dades en format JSON i un codi d'estat.

Per poder respondre en dades en format JSON hem implementat el mètode
`Response::jsonResponse`.

```php
/**
  * @param $element
  * @return false|string
*/
public function jsonResponse(array $element, integer $code)
{
    header('Content-Type: application/json; charset=UTF-8');
    return json_encode($element);
}
```


```php
# src/Controllers/ApiController.php
    
/**
  * @return string
  * @throws \App\Core\Exception\ModelException
*/
public function index(): string
{
    $movieModel = App::getModel(MovieModel::class);
    $movies = $movieModel->findAllPaginated(1, 8,
        ["release_date" => "DESC", "title" => "ASC"]);
    return $this->response->jsonResponse($movies);
}
```



## Prova de la API amb Postman

## Documentació de la API amb Nelmio Api Doc Bundle.

## Consumir la API amb JQuery.Ajax

Per a provar-ho crearem un nou mètode `DefaultController::index-ajax()` que respondrà a la ruta `/index-ajax` 

```php
    /**
     * @Route("/index-ajax", name="homepage_ajax")
     */
    public function index_ajax(Request $request)
    {

        return $this->render('default/index-ajax.html.twig');
    }
```

La plantilla `default/index-ajax.html.twig` serà una plantilla senzilla que sols contindrà el javascript necessari per mostrar els links.

Per poder accedir a jQuery des de fora de Webpack JavaScript caldrà fer dues coses:

1. Activar `.autoProvidejQuery()` en `webpack.config.js`.
2. Afegir `global.$=global.jQuery=$` en `app.js`.

Després compilarem el codi: yarn encore dev.

Afegirem en el bloc `javascripts` d'`index-ajax.html.twig` el javascript necessari per fer la crida i obtindre tots els links.




