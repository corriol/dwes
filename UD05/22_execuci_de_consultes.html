<!doctype html>
<html lang="ca">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>2.2. Execució de consultes </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning  - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-6"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<section id="emptyHeader"></section>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Inici</a></li>
   <li><a href="1_maneig_de_phpmyadmin.html" class="no-ch">1. Maneig de PHPMyAdmin</a></li>
   <li class="current-page-parent"><a href="2_accs_a_la_base_de_dades_mitjanant_php_amb_la_llibreria_pdo.html" class="current-page-parent daddy">2. Accés a la base de dades mitjançant PHP amb la llibreria PDO</a>
   <ul>
      <li><a href="21_connexi_a_la_base_de_dades.html" class="no-ch">2.1. Connexió a la base de dades</a></li>
      <li id="active"><a href="22_execuci_de_consultes.html" class="active no-ch">2.2. Execució de consultes</a></li>
      <li><a href="23_consultes_preparades.html" class="no-ch">2.3. Consultes preparades</a></li>
      <li><a href="24_inserci_modificaci_i_eliminaci_de_dades_de_la_bbdd.html" class="no-ch">2.4. Inserció, modificació i eliminació de dades de la BBDD</a></li>
      <li><a href="25_gesti_derrors_en_laccs.html" class="no-ch">2.5. Gestió d'errors en l'accés</a></li>
      <li><a href="exercicis_prctics.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
   <li><a href="3_simplificant_laccs_a_la_base_de_dades.html" class="daddy">3. Simplificant l'accés a la base de dades</a>
   <ul class="other-section">
      <li><a href="exercicis_prctics0.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
   <li><a href="4_transaccions.html" class="daddy">4. Transaccions</a>
   <ul class="other-section">
      <li><a href="exercicis_prctics1.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="21_connexi_a_la_base_de_dades.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="23_consultes_preparades.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">2.2. Execució de consultes</h1></header>
<article class="iDevice_wrapper FreeTextIdevice" id="id4">
<div class="iDevice emphasis0">
<div id="ta4_85" class="block iDevice_content">
<p>Les dades s'obtenen a través del mètode -&gt; fetch () o -&gt; fetchAll () (PDOStatement).</p>
<p>-&gt; fetch (): Obté la següent fila d'un recordset (conjunt de resultats). http://php.net/manual/es/pdostatement.fetch.php<br />-&gt; fetchAll (): Retorna un array que conté totes les files del conjunt de resultats (el tipus de dades a retornar es pot indicar com a paràmetre). http://php.net/manual/es/pdostatement.fetchall.php</p>
<p>Abans de cridar al mètode -&gt; fetch () una bona idea és indicar-li com volem que ens retorne les dades de la base de dades.</p>
<p>Tindrem les següents opcions en el mètode -&gt; fetch ():</p>
<ul>
<li>PDO :: FETCH_ASSOC: torna un array indexat pel nom de camp de la taula.</li>
<li>PDO :: FETCH_BOTH: (per defecte): retorna un array indexat per nom de camp de la taula i per nombre de camp.</li>
<li>PDO :: FETCH_BOUND: Assigna els valors retornats a les variables assignades amb el mètode -&gt; bindColumn ().</li>
<li>PDO :: FETCH_CLASS: Assigna els valors dels camps a les propietats d'una classe. Si les propietats no existeixen en aquesta classe, les crearà.</li>
<li>PDO :: FETCH_INTO: Actualitza una instància existent d'una classe.</li>
<li>PDO :: FETCH_LAZY: Combina PDO :: FETCH_BOTH / PDO :: FETCH_OBJ, creant les variables de l'objecte a mesura que es van fent servir.</li>
<li>PDO :: FETCH_NUM: Retorna un array indexat pel nombre de camp.</li>
<li>PDO :: FETCH_OBJ: Retorna un objecte anònim amb els noms de les propietats que es corresponen amb els noms de columnes.</li>
</ul>
<p>Per ajustar la manera de resposta:</p>
<p>$stmt-&gt; setFetchMode (PDO :: FETCH_ASSOC);</p>
<p>FETCH_ASSOC</p>
<p>Per executar la consulta SELECT si no tenim paràmetres en la consulta podrem usar -&gt; query () de l'objecte PDO</p>
<p>Vegem un exemple de consulta SELECT:</p>
<div class="highlighted-code language-php">
<div>
<pre><code>try {
    #Per executar la consulta SELECT si no tenim paràmetres en la consulta podrem usar -&gt; query ()
    $stmt = $pdo-&gt; query ( 'SELECT name, addr, city from col·legi');
   #Indiquem en quin format volem obtenir les dades de la taula en format d'array associatiu.
   #Si no indiquem res per defecte s'usarà FETCH_BOTH el que ens permetrà accedir com a vector associatiu o array numèric.
    $stmt-&gt; setFetchMode (PDO :: FETCH_ASSOC);

    #Llegim les dades del recordset amb el mètode -&gt; fetch ()
    while ($ row = $ stmt-&gt; fetch ()) {
        echo $ row [ 'name']. "&lt;br/&gt;";
        echo $ row [ 'addr']. "&lt;br/&gt;";
        echo $ row [ 'city']. "&lt;br/&gt;";
    }

    #Per alliberar els recursos utilitzats en la consulta SELECT
    $stmt = null;
} Catch (PDOException $ err) {
    // Mostrem un missatge genèric d'error.
    echo "Error: executant consulta SQL.";
}


# ------------------------------------------------- ----------------------------------------------
# Per executar la consulta SELECT si tenim paràmetres ho faríem així:

# Preparem la consulta com sempre
$stmt = $ pdo-&gt; prepare( 'SELECT name, addr, city from col·legues where city =: ciutat');

try {
    #indiquem en quin format volem obtenir les dades de la taula en format d'array associatiu.
    #Si no indiquem res per defecte s'usarà FETCH_BOTH el que ens permetrà accedir com a vector associatiu o array numèric.
    $stmt-&gt; execute (array ( 'ciutat' =&gt; 'Santiago de Compostel·la');
    #Llegim les dades del recordset amb el mètode -&gt; fetch ()
    #Per defecte ja els torna a forma de vector associatiu si no indiquem res amb setFetchMode ()

    while ($ row = $ stmt-&gt; fetch ())
    {
        echo $ row [ 'name']. "&lt;br/&gt;";
        echo $ row [ 'addr']. "&lt;br/&gt;";
        echo $ row [ 'city']. "&lt;br/&gt;";
    }

#Per alliberar els recursos de la consulta SELECT
$stmt = null;
}
catch (PDOException $err) {
// Mostrem un missatge genèric d'error.
    echo "Error: executant consulta SQL.";
}
</code></pre>
</div>
</div>
<p><strong>FETCH_OBJ</strong></p>
<p>En aquest tipus de manera de consulta es crearà un objecte estàndard per cada fila que llegim del recordset.</p>
<p>exemple:</p>
<div class="highlighted-code language-php">
<div>
<pre><code>try {
    #Creem la consulta
    $stmt = $ pdo-&gt; query ( 'SELECT name, addr, city from col·legues');
    #Ajustem la manera d'obtenció de dades
    $stmt-&gt; setFetchMode (PDO :: FETCH_OBJ);

    #Mostrem els resultats.
    #Fixeu-vos que es torna un objecte cada vegada que es llegeix una fila del recordset.

    while ($ row = $ stmt-&gt; fetch ()) {
        echo $ row-&gt; name. "&lt;br/&gt;";
        echo $ row-&gt; addr. "&lt;br/&gt;";
        echo $ row-&gt; city. "&lt;br/&gt;";
    }

    #Alliberem els recursos utilitzats per $stmt
    $stmt = null;
}
catch (PDOException $ err)
{
// Mostrem un missatge genèric d'error.
echo "Error: executant consulta SQL.";
}</code></pre>
</div>
</div>
<p></p>
<p></p>
<p></p>
</div>
</div>
</article>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Llicència Creative Commons Reconeixement CompartirIgual 4.0</a></p>
</div>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="21_connexi_a_la_base_de_dades.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="23_consultes_preparades.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>