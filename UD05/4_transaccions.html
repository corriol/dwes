<!doctype html>
<html lang="ca">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4. Transaccions </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning  - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-4"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<section id="emptyHeader"></section>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Inici</a></li>
   <li><a href="1_maneig_de_phpmyadmin.html" class="no-ch">1. Maneig de PHPMyAdmin</a></li>
   <li><a href="2_accs_a_la_base_de_dades_mitjanant_php_amb_la_llibreria_pdo.html" class="daddy">2. Accés a la base de dades mitjançant PHP amb la llibreria PDO</a>
   <ul class="other-section">
      <li><a href="21_connexi_a_la_base_de_dades.html" class="no-ch">2.1. Connexió a la base de dades</a></li>
      <li><a href="22_execuci_de_consultes.html" class="no-ch">2.2. Execució de consultes</a></li>
      <li><a href="23_consultes_preparades.html" class="no-ch">2.3. Consultes preparades</a></li>
      <li><a href="24_inserci_modificaci_i_eliminaci_de_dades_de_la_bbdd.html" class="no-ch">2.4. Inserció, modificació i eliminació de dades de la BBDD</a></li>
      <li><a href="25_gesti_derrors_en_laccs.html" class="no-ch">2.5. Gestió d'errors en l'accés</a></li>
      <li><a href="exercicis_prctics.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
   <li><a href="3_simplificant_laccs_a_la_base_de_dades.html" class="daddy">3. Simplificant l'accés a la base de dades</a>
   <ul class="other-section">
      <li><a href="exercicis_prctics0.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
   <li id="active"><a href="4_transaccions.html" class="active daddy">4. Transaccions</a>
   <ul>
      <li><a href="exercicis_prctics1.html" class="no-ch">Exercicis pràctics</a></li>
   </ul>
   </li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="exercicis_prctics0.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis_prctics1.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4. Transaccions</h1></header>
<article class="iDevice_wrapper FreeTextIdevice" id="id15">
<div class="iDevice emphasis0">
<div id="ta15_85" class="block iDevice_content">
<h2>Introducció</h2>
<p>Una transacció en un Sistema de Gestió de Bases de Dades és un conjunt d'ordres que s'executen formant una unitat de treball, és a dir, en forma indivisible o atòmica.</p>
<p>Un SGBD es diu transaccional si és capaç de mantenir la integritat de dades, fent que aquestes transaccions no puguin finalitzar en un estat intermedi. Quan per alguna causa el sistema ha de cancel·lar la transacció, comença a desfer les ordres executades fins a deixar la base de dades en el seu estat inicial (anomenat punt d'integritat), com si l'ordre de la transacció mai s'hagués realitzat. Una transacció ha de comptar amb ACID (un acrònim anglès) que vol dir: Atomicidad, consistència, aïllament i durabilitat.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextIdevice" id="id16">
<div class="iDevice emphasis0">
<div id="ta16_85" class="block iDevice_content">
<h2>Transaccions en PDO</h2>
<p>Com ja hem comentat, no tots els SGBD són transaccionals. Però també es possible que tot i que el SGBD ho siga el motor d'emmagatzemat no ho suporte. Per la qual cosa si necessites utilitzar transaccions hauràs d'assegurar-se que estiguen suportades pel motor d'emmagatzematge que gestiona les teves taules en MySQL. Per exemple el motor MyISAM no les suporta.</p>
<p>Per defecte PDO treballa en mode autocommit. Confirma automàticament cada sentència que executa el servidor.</p>
<p>Per treballar amb transaccions, PDO incorpora tres mètodes:</p>
<ul>
<li><code>beginTransaction</code>. Deshabilita la manera autocommit i comença una nova transacció, que finalitzarà quan executis un dels dos mètodes<br />següents.</li>
<li><code> commit</code>. Confirma la transacció actual.</li>
<li><code>rollback</code>. Reverteix els canvis duts a terme a la transacció actual.</li>
</ul>
<p>Un cop executat un <code>commit</code> o <code>rollback</code>, es tornarà al mode de confirmació automàtica.</p>
<div class="exe-block-alert">
<p>Si utilitzem un motor que no suporta transaccions PDO no mostrarà cap error, simplement serà incapaç de realitzar un <code>rollback</code> si fora necessari.</p>
</div>
<h3>Esquema bàsic d'ús de transaccions amb PDO</h3>
<div class="highlighted-code language-php">
<pre><code>#Esquema bàsic d'ús de PDO
try{ 
    $pdo-&gt;beginTransaction(); 
    $pdo-&gt;exec('DELETE ...'); 
    $pdo-&gt;exec('UPDATE ...'); 
    $pdo-&gt;commit(); 
}
catch(PDOException $exception) { 
    $pdo-&gt;rollback(); 
}</code></pre>
</div>
<h3>Exemple</h3>
<div class="highlighted-code language-php">
<div>
<pre><code>$mbd = new PDO('odbc:SAMPLE', 'db2inst1', 'ibmdb2',
        array(PDO::ATTR_PERSISTENT =&gt; true));
    echo "Conectado\n";
} catch (Exception $e) {
    die("No se pudo conectar: " . $e-&gt;getMessage());
}

try {
    $mbd-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $mbd-&gt;beginTransaction();
    $mbd-&gt;exec("insert into staff (id, first, last) values (23, 'Joe', 'Bloggs')");
    $mbd-&gt;exec("insert into salarychange (id, amount, changedate) 
      values (23, 50000, NOW())");
    $mbd-&gt;commit();

} catch (Exception $e) {
    $mbd-&gt;rollBack();
    echo "Fallo: " . $e-&gt;getMessage();
}
</code></pre>
</div>
</div>
<p></p>
</div>
</div>
</article>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Llicència Creative Commons Reconeixement CompartirIgual 4.0</a></p>
</div>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="exercicis_prctics0.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis_prctics1.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>